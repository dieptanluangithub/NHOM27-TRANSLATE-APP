<!DOCTYPE html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<html>
<head>
    <meta charset="UTF-8">
    <nav class="navbar fixed-top navbar-expand-lg bg-dark navbar-dark">
        <a class="navbar-brand" href="index.html">
            <img src="/static/images/1.png" width="30" height="30" class="d-inline-block align-top" alt="#">
            DTL TRANSLATE APP
        </a>
    </nav>
    <title>DTL Translate App</title>
    <script src="aws-sdk/dist/aws-sdk.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1048.0.min.js"></script>

</head>

<body class="container-fluid">
<img src="/static/images/2.png" align="middle" class="img" alt="Responsive image" vspace="40">
<h1 class="text-center text-info"> DTL TRANSLATE APP </h1>
<table class="tg">
    <tr>
        <th align="left">
            <button type="button" class="btn btn-success">Source Language Code</button>
            <select id="sourceLanguageCodeDropdown">
                <option value="en">en</option>
                <option value="ar">ar</option>
                <option value="cs">cs</option>
                <option value="de">de</option>
                <option value="es">es</option>
                <option value="fr">fr</option>
                <option value="it">it</option>
                <option value="ja">ja</option>
                <option value="pt">pt</option>
                <option value="ru">ru</option>
                <option value="tr">tr</option>
                <option value="vi">vi</option>
                <option value="zh">zh</option>
                <option value="zh-TW">zh-TW</option>
            </select>
        </th>
        <th align="left">
            <button type="button" class="btn btn-success">Target Language Code</button>
            <select id="targetLanguageCodeDropdown">
                <option value="en">en</option>
                <option value="ar">ar</option>
                <option value="cs">cs</option>
                <option value="de">de</option>
                <option value="es">es</option>
                <option value="fr">fr</option>
                <option value="it">it</option>
                <option value="ko">ko</option>
                <option value="ja">ja</option>
                <option value="pt">pt</option>
                <option value="ru">ru</option>
                <option value="tr">tr</option>
                <option value="zh">zh</option>
                <option value="vi">vi</option>
                <option value="zh-TW">zh-TW</option>
            </select>
        </th>
    </tr>
    <tr>
        <th>
            <textarea id="inputText" name="inputText" rows="10" cols="86.5" placeholder="Text to translate..."></textarea>
        </th>
        <th>
            <textarea id="outputText" name="outputText" rows="10" cols="86.5" placeholder="Translated text..."></textarea>
        </th>
    </tr>
    <tr>
        <th align="left">
            <button type="submit" class="btn btn-warning" name="translateButton" onclick="doTranslate()">TRANSLATE</button>
            <button type="submit" class="btn btn-primary" name="synthesizeButton" onclick="doSynthesizeInput()">LISTEN INPUT</button>
            <button type="submit" class="btn btn-danger" name="clearButton" onclick="clearInputs()">CLEAR</button>
        </th>
        <th align="left">
            <button type="submit" class="btn btn-primary" name="synthesizeButton" onclick="doSynthesizeOutput()">LISTEN OUTPUT</button>
        </th>
    </tr>
</table>
<script type="text/javascript">
        // set the focus to the input box
        document.getElementById("inputText").focus();

        /**
        * Change the region and endpoint.
        */
        AWS.config.region = 'us-east-1'; // Region

         /**
         * In a production application you should use a secure method of authenticating uses, such as the ones
         * described here:
         *   https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/setting-credentials-browser.html
         *
         * Note that Amazon Translate does not work with Amazon Cognito Identity.
         *
         * For this example you place the credentials of an IAM user in the HTML page. The IAM user associated
         * with these credentials must have permissions to call Amazon Translate. We recommend using the following
         * permissions policy and nothing more, as anyone that has access to this HTML page will also have access to
         * these hard-coded credentials.
         * {
         *     "Version": "2012-10-17",
         *     "Statement": [
         *         {
         *             "Action": [
         *                 "translate:TranslateText",
         *                 "polly:SynthesizeSpeech"
         *             ],
         *             "Resource": "*",
         *             "Effect": "Allow"
         *         }
         *     ]
         * }
         *
         * For more information about the AWS Credentials object, see:
         *   http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Credentials.html
         */
        AWS.config.credentials = new AWS.Credentials("AKIARXPVFERQOG7RA66J", "9+mUkXIQw+DSYvPsveSG2i+biUvtaSNqGkKFBnep");

        var translate = new AWS.Translate({region: AWS.config.region});
        var polly = new AWS.Polly();

        function doTranslate() {
            var inputText = document.getElementById('inputText').value;
            if (!inputText) {
                alert("Input text cannot be empty.");
                exit();
            }

            // get the language codes
            var sourceDropdown = document.getElementById("sourceLanguageCodeDropdown");
            var sourceLanguageCode = sourceDropdown.options[sourceDropdown.selectedIndex].text;

            var targetDropdown = document.getElementById("targetLanguageCodeDropdown");
            var targetLanguageCode = targetDropdown.options[targetDropdown.selectedIndex].text;

            var params = {
                Text: inputText,
                SourceLanguageCode: sourceLanguageCode,
                TargetLanguageCode: targetLanguageCode
            };

            translate.translateText(params, function(err, data) {
                if (err) {
                    console.log(err, err.stack);
                    alert("Error calling Amazon Translate. " + err.message);
                    return;
                }
                if (data) {
                    var outputTextArea = document.getElementById('outputText');
                    outputTextArea.value = data.TranslatedText;
                }
            });
        }

        function doSynthesizeInput() {
            var text = document.getElementById('inputText').value.trim();
            if (!text) {
                return;
            }
            var sourceLanguageCode = document.getElementById("sourceLanguageCodeDropdown").value;
            doSynthesize(text, sourceLanguageCode);
        }

        function doSynthesizeOutput() {
            var text = document.getElementById('outputText').value.trim();
            if (!text) {
                return;
            }
            var targetLanguageCode = document.getElementById("targetLanguageCodeDropdown").value;
            doSynthesize(text, targetLanguageCode);
        }

        function doSynthesize(text, languageCode) {
            var voiceId;
            switch (languageCode) {
                case "de":
                    voiceId = "Marlene";
                    break;
                case "en":
                    voiceId = "Joanna";
                    break;
                case "es":
                    voiceId = "Penelope";
                    break;
                case "fr":
                    voiceId = "Celine";
                    break;
                case "pt":
                    voiceId = "Vitoria";
                    break;
                case "ja":
                    voiceId = "Takumi";
                    break;
                case "ko":
                    voiceId = "Seoyeon";
                    break;
                case "ru":
                    voiceId = "Maxim";
                    break;
                default:
                    voiceId = null;
                    break;
            }
            if (!voiceId) {
                alert("Hiện tại chưa hỗ trợ giọng nói cho ngôn ngữ \"" + languageCode + "\"");
                return;
            }
            var params = {
                OutputFormat: "mp3",
                SampleRate: "8000",
                Text: text,
                TextType: "text",
                VoiceId: voiceId
            };
            polly.synthesizeSpeech(params, function(err, data) {
                if (err) {
                    console.log(err, err.stack); // an error occurred
                    alert("Error calling Amazon Polly. " + err.message);
                }
                else {
                    var uInt8Array = new Uint8Array(data.AudioStream);
                    var arrayBuffer = uInt8Array.buffer;
                    var blob = new Blob([arrayBuffer]);
                    var url = URL.createObjectURL(blob);

                    audioElement = new Audio([url]);
                    audioElement.play();
                }
            });
        }

        function clearInputs() {
            document.getElementById('inputText').value = "";
            document.getElementById('outputText').value = "";
            document.getElementById("sourceLanguageCodeDropdown").value = "en";
            document.getElementById("targetLanguageCodeDropdown").value = "vi";
        }
    </script>
</body>

<footer>
    <div class="jumbotron">
        <h1>DTL TRANSLATE APP</h1>
        <p> Trang web dịch thuật hàng đầu Việt Nam</p>
        <p> Diệp Tấn Luân &copy; 2021</p>
    </div>
</footer>
</html>
